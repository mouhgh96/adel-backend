# Migration `20201029173600-init`

This migration has been generated by Gharbi Mohamed at 10/29/2020, 6:36:01 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Question" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "title" TEXT NOT NULL,
    "content" TEXT NOT NULL,
    "authorId" INTEGER NOT NULL,
    "domainId" INTEGER NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,

    FOREIGN KEY ("authorId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("domainId") REFERENCES "Domain"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Response" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "content" TEXT NOT NULL,
    "toId" INTEGER NOT NULL,
    "createdAt" DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" DATETIME NOT NULL,
    "fromId" INTEGER NOT NULL,

    FOREIGN KEY ("toId") REFERENCES "Question"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("fromId") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "User" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "email" TEXT NOT NULL,
    "username" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "firstName" TEXT NOT NULL,
    "lastName" TEXT NOT NULL,
    "domainId" INTEGER NOT NULL,
    "isAdmin" BOOLEAN NOT NULL DEFAULT false,
    "equipe" INTEGER NOT NULL,

    FOREIGN KEY ("domainId") REFERENCES "Domain"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "Domain" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL
)

CREATE TABLE "Competence" (
    "id" INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL,
    "domainId" INTEGER NOT NULL,

    FOREIGN KEY ("domainId") REFERENCES "Domain"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE TABLE "_CompetenceToUser" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL,

    FOREIGN KEY ("A") REFERENCES "Competence"("id") ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY ("B") REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "User.username_unique" ON "User"("username")

CREATE UNIQUE INDEX "Domain.name_unique" ON "Domain"("name")

CREATE UNIQUE INDEX "Competence.name_unique" ON "Competence"("name")

CREATE UNIQUE INDEX "_CompetenceToUser_AB_unique" ON "_CompetenceToUser"("A", "B")

CREATE INDEX "_CompetenceToUser_B_index" ON "_CompetenceToUser"("B")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201029173600-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,64 @@
+datasource db {
+  provider = "sqlite"
+  url = "***"
+ 
+}
+
+generator client {
+  provider = "prisma-client-js"
+  experimentalFeatures = ["connectOrCreate"]
+}
+
+model Question {
+  id             Int      @id @default(autoincrement())
+  title          String 
+  content        String 
+  author         User     @relation(fields: [authorId], references: [id])
+  authorId       Int
+  domainId       Int
+  domain         Domain   @relation(fields: [domainId], references: [id])
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+  responses      Response[]
+}
+
+model Response {
+  id             Int        @id @default(autoincrement())
+  content        String
+  to             Question   @relation(fields: [toId], references: [id])
+  toId           Int
+  createdAt      DateTime   @default(now())
+  updatedAt      DateTime   @updatedAt
+  from           User       @relation(fields: [fromId], references: [id])
+  fromId         Int
+}
+model User {
+  id             Int     @id @default(autoincrement())
+  email          String  @unique
+  username       String  @unique
+  password       String
+  questions      Question[]
+  firstName      String
+  lastName       String
+  domain         Domain   @relation(fields: [domainId], references: [id])
+  domainId       Int
+  competences    Competence[] 
+  isAdmin        Boolean  @default(false)
+  equipe         Int
+}
+
+model Domain {
+  id             Int     @id @default(autoincrement())
+  name           String  @unique
+  questions      Question[]
+  users          User[]
+  competences    Competence[] 
+}
+
+model Competence {
+  id             Int     @id @default(autoincrement())
+  name           String  @unique
+  users          User[]
+  domain         Domain   @relation(fields: [domainId], references: [id])
+  domainId       Int
+}
```


